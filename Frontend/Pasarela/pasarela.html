<html lang="en">
  <head>
    <link rel="stylesheet" href="pasaStyle.css" />
    <title>Pasarela de pago</title>
  </head>
  <body style="background-color: #efefef">
    <header>
      <h1>Pagos</h1>
    </header>
    <div class="generalcont">
      <div class="paycheck">
        <form id="transactionform">
          <a class="texto" style="font-size: x-large">Datos personales:</a>
          <div>
            <a class="texto">Nombre completo:</a>
            <input
              type="text"
              name="name"
              class="input"
              placeholder="Enter name"
            />
          </div>
          <div>
            <a class="texto">E-mail:</a>
            <input
              type="text"
              name="email"
              class="input"
              placeholder="Enter text"
            />
          </div>
          <div>
            <div class="palado">
              <a class="texto">ID:</a>
              <select
                style="margin-left: 10px; margin-top: 9px; height: 40%"
                id="TipoDoc"
                name="TipoDeDoc"
              >
                <option disabled selected value="">Elija un tipo de ID.</option>
                <option value="Pasaporte">Pasaporte</option>
                <option value="Cedula">Cedula</option>
                <option value="Tarjeta de Identidad">
                  Tarjeta de Identidad
                </option>
              </select>
            </div>

            <input
              type="text"
              class="input"
              name="cdi"
              placeholder="Enter ID"
            />
          </div>
          <div class="pabajo">
            <a class="texto" style="font-size: x-large">Método de pago:</a>
            <div class="palado">
              <div class="opciones">
                <input
                  type="radio"
                  id="debito"
                  name="TipoTarjeta"
                  value="debito"
                />
                <label class="textoopciones">Tarjeta de debito</label>
              </div>
              <div class="opciones">
                <input
                  type="radio"
                  id="credito"
                  name="TipoTarjeta"
                  value="credito"
                />
                <label class="textoopciones">Tarjeta de credito</label>
              </div>
            </div>
          </div>

          <div style="display: flex">
            <div>
              <div class="pabajo">
                <a class="texto">Tarjeta:</a>
                <input
                  type="text"
                  name="card"
                  class="input"
                  placeholder="0000-0000-0000-0000"
                  maxlength="19"
                />
              </div>
              <div style="display: flex">
                <div class="pabajo">
                  <a class="texto">CCV:</a>
                  <input
                    style="width: 4.5rem"
                    name="ccv"
                    type="text"
                    class="input"
                    placeholder="000"
                    maxlength="3"
                  />
                </div>
                <div class="pabajo">
                  <a class="texto">Número de cuotas:</a>
                  <select
                    style="
                      margin-left: 10px;
                      width: 50%;
                      margin-top: 5px;
                      height: 40%;
                    "
                    id="cuotas"
                    name="cuotas"
                  >
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="4">4</option>
                    <option value="8">8</option>
                    <option value="12">12</option>
                    <option value="24">24</option>
                    <option value="36">36</option>
                    <option value="48">48</option>
                    <option value="60">60</option>
                  </select>
                </div>
              </div>
            </div>
            <div>
              <div class="pabajo">
                <a class="texto">Fecha de Vencimiento:</a>
                <div class="palado">
                  <input
                    style="margin-left: 10px; margin-top: 5px"
                    class="texto"
                    type="month"
                    name="expdate"
                    placeholder="expdate"
                  />
                </div>
                <img
                  style="width: 12rem; padding-top: 45px"
                  src="Assets\Logos.png"
                />
              </div>
            </div>
          </div>
          <div style="margin-top: 50px" class="palado">
            <div class="opciones">
              <input
                type="radio"
                id="Estemedio"
                name="Mediodepago"
                value="Local"
              />
              <label class="textoopciones">Pago por este medio</label>
            </div>
            <div class="opciones">
              <input type="radio" id="PSE" name="Mediodepago" value="PSE" />
              <img style="width: 12rem; padding: 5px" src="Assets\PSE.png" />
            </div>
          </div>
        </form>

        <!-- Scripts para la conexión al backend -->
        <script>
          async function sendtransaction() {
            var form = document.getElementById("transactionform");

            // Get form data
            const formData = new FormData(form);

            // Convert form data to JSON object
            const jsonData = {};
            formData.forEach((value, key) => {
              jsonData[key] = value;
            });

            const urls = [
              "http://localhost:3000/EastBank/users/" +
                jsonData.email +
                "/" +
                jsonData.cdi,
              "http://localhost:3100/WesternBank/users/" +
                jsonData.email +
                "/" +
                jsonData.cdi,
            ];

            let userinfo = {} 

            try {
              // Send request to user server 1
              const userResponse1 = await fetch(urls[0], {
                method: "GET",
              });

              // Check if user exists in user server 1
              if (userResponse1.ok) {
                const userData = await userResponse1.json();
                // User exists in user server 1, process user data and continue
                console.log("User data:", userData);
                userinfo = userData;
              } else {
                // User does not exist in user server 1, check user server 2
                const userResponse2 = await fetch(urls[1], {
                  method: "GET",
                });

                // Check if user exists in user server 2
                if (userResponse2.ok) {
                  const userData = await userResponse2.json();
                  // User exists in user server 2, process user data and continue
                  console.log("User data:", userData);
                  userinfo = userData;

                } else {
                  // User does not exist in both user servers
                  document.getElementById("info").innerText = "User not found in the database";
                }
              }
              if (Object.keys(userinfo).length > 0) {
                document.getElementById("info").innerText = "user found";
              }
            } catch (error) {
              console.error("Error occurred:", error);
            }
          }
        </script>
      </div>
      <div class="contenedor">
        <div class="payinfo" id="payinfo">
          <div style="display: flex; justify-content: center; flex-direction: column; justify-content: space-between;">
            <div>
              <h1 id="info"></h1>
            </div>
            <button
              type="button"
              onclick="sendtransaction()"
              style="margin-bottom: 20px"
            >
              Pagar
            </button>
          </div>
        </div>
        <div class="instrucciones">
          <h1>Instrucciones</h1>
          <p>1. Ingresar datos personales</p>
          <br />
          <p>2. Escoger medio de pago</p>
          <br />
          <p>3. Ingresar datos de la tarjeta</p>
          <br />
          <p>4. Oprimir el boton de pagar</p>
        </div>
      </div>
    </div>
  </body>
</html>
